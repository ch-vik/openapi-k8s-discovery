<!DOCTYPE html>
<html lang="en">
  <head>
    <title>API Documentation</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      /* Only style the API selector - no global styles that could affect Redoc */
      #api-selector {
        padding: 0.625rem 1rem;
        background: #1f1f1f;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        gap: 0.75rem;
        flex-wrap: wrap;
        box-sizing: border-box;
      }
      #api-selector > label {
        margin: 0;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.85);
        font-size: 0.8125rem;
        white-space: nowrap;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        letter-spacing: 0.01em;
        text-transform: uppercase;
        box-sizing: border-box;
      }
      #api-selector > select {
        padding: 0.375rem 2rem 0.375rem 0.75rem;
        font-size: 0.875rem;
        width: auto;
        min-width: 200px;
        max-width: 350px;
        background-color: #2d2d2d;
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 4px;
        color: #ffffff;
        cursor: pointer;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        appearance: none;
        transition: all 0.2s ease;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 12 12'%3E%3Cpath fill='%23ffffff' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 0.625rem center;
        background-size: 10px;
        box-sizing: border-box;
        margin: 0;
      }
      #api-selector > select:hover {
        background-color: #363636;
        border-color: rgba(255, 255, 255, 0.2);
      }
      #api-selector > select:focus {
        outline: none;
        border-color: #4a9eff;
        box-shadow: 0 0 0 2px rgba(74, 158, 255, 0.3);
        background-color: #363636;
      }
      #api-selector > select option {
        background-color: #2d2d2d;
        color: #ffffff;
      }
      #redoc-container {
        height: calc(100vh - 44px);
      }
      @media (max-width: 576px) {
        #api-selector {
          flex-direction: column;
          align-items: stretch;
        }
        #api-selector > select {
          min-width: 100%;
          max-width: 100%;
        }
      }
    </style>
  </head>
  <body>
    {% if show_api_selector && has_multiple_apis %}
    <div id="api-selector">
      <label for="api-select">Select API:</label>
      <select id="api-select" onchange="loadApi(this.value)">
        {% for api in apis %}
        <option value="{{ api.slug }}">{{ api.name }}</option>
        {% endfor %}
      </select>
    </div>
    {% endif %}
    <div id="redoc-container"></div>
    <script src="https://cdn.redoc.ly/redoc/latest/bundles/redoc.standalone.js"></script>
    <script>
      {% if has_multiple_apis %}
      const apis = {
        {% for api in apis %}
        '{{ api.slug }}': '{{ api.spec_url }}'{%- if !loop.last %},{%- endif %}
        {% endfor %}
      };

      const STORAGE_KEY = 'redoc-selected-api';

      function loadApi(slug) {
        if (!apis[slug]) {
          // Invalid slug, use first API
          slug = '{{ apis[0].slug }}';
        }
        
        const specUrl = apis[slug];
        const container = document.getElementById('redoc-container');
        const selectElement = document.getElementById('api-select');
        
        // Update dropdown to match
        if (selectElement) {
          selectElement.value = slug;
        }
        
        // Save to localStorage
        try {
          localStorage.setItem(STORAGE_KEY, slug);
        } catch (e) {
          // Ignore localStorage errors (e.g., in private mode)
        }
        
        container.innerHTML = '';
        Redoc.init(specUrl, {
          expandResponses: '{{ expand_responses }}',
          requiredPropsFirst: {{ required_props_first }}
        }, container);
      }

      // Load API on page load - check localStorage first, then use first API
      (function() {
        let initialSlug = '{{ apis[0].slug }}';
        try {
          const savedSlug = localStorage.getItem(STORAGE_KEY);
          if (savedSlug && apis[savedSlug]) {
            initialSlug = savedSlug;
          }
        } catch (e) {
          // Ignore localStorage errors
        }
        loadApi(initialSlug);
      })();
      {% else %}
      Redoc.init('{{ apis[0].spec_url }}', {
        expandResponses: '{{ expand_responses }}',
        requiredPropsFirst: {{ required_props_first }}
      }, document.getElementById('redoc-container'));
      {% endif %}
    </script>
  </body>
</html>

